{% extends "base.html" %}
{% block title %}Inbox â€” Research Index{% endblock %}
{% block content %}
<h1>Inbox</h1>

<div class="filter-row" style="margin-bottom:1rem;">
    <label>Status:</label>
    <a href="/inbox?status=new" class="btn {% if current_status == 'new' %}{% else %}btn-secondary{% endif %}" style="font-size:0.8rem; padding:0.3rem 0.6rem;">New</a>
    <a href="/inbox?status=accepted" class="btn btn-secondary" style="font-size:0.8rem; padding:0.3rem 0.6rem;">Accepted</a>
    <a href="/inbox?status=rejected" class="btn btn-secondary" style="font-size:0.8rem; padding:0.3rem 0.6rem;">Rejected</a>
    <a href="/inbox?status=all" class="btn btn-secondary" style="font-size:0.8rem; padding:0.3rem 0.6rem;">All</a>
</div>

{% if inbox_items %}
{% for it in inbox_items %}
<div class="card">
    <h3>{{ it.title }}</h3>
    <p class="meta">
        {{ it.source_id_type }}:{{ it.source_id_value }}
        | Year: {{ it.year or "?" }}
        {% if it.venue %}| {{ it.venue }}{% endif %}
        | Status: <span class="badge">{{ it.status }}</span>
    </p>
    {% if it.abstract %}
    <p class="abstract">{{ it.abstract[:300] }}{% if it.abstract|length > 300 %}...{% endif %}</p>
    {% endif %}
    {% if it.status == "new" %}
    <div style="display:flex; gap:0.5rem; margin-top:0.5rem;">
        <form method="post" action="/inbox/{{ it.id }}/accept">
            <button type="submit" style="font-size:0.8rem; padding:0.3rem 0.6rem;">Accept</button>
        </form>
        <form method="post" action="/inbox/{{ it.id }}/reject">
            <button type="submit" class="btn-secondary" style="font-size:0.8rem; padding:0.3rem 0.6rem;">Reject</button>
        </form>
    </div>
    {% endif %}
</div>
{% endfor %}
{% else %}
<p class="meta">No inbox items (status={{ current_status }}).</p>
{% endif %}
{% endblock %}
