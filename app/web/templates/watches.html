{% extends "base.html" %}
{% block title %}Watch 一覧 — Research Intelligence{% endblock %}
{% block content %}
<h1>Watch 一覧</h1>

<div class="card">
    <h2>Watch を追加</h2>
    <form method="post" action="/watches" style="display:flex; gap:0.5rem; flex-wrap:wrap; align-items:end;">
        <div>
            <label class="meta">名前</label><br>
            <input type="text" name="name" required placeholder="my-watch">
        </div>
        <div>
            <label class="meta">ソース</label><br>
            <select name="source">
                <option value="arxiv">arXiv</option>
                <option value="openalex">OpenAlex</option>
            </select>
        </div>
        <div>
            <label class="meta">クエリ</label><br>
            <input type="text" name="query" required placeholder="retrieval augmented generation" style="min-width:250px;">
        </div>
        <div>
            <label class="meta">カテゴリ (arXiv)</label><br>
            <input type="text" name="category" placeholder="cs.CL">
        </div>
        <button type="submit">追加</button>
    </form>
</div>

{% if watches %}
<h2>登録済み Watch</h2>
{% for w in watches %}
<div class="card" style="display:flex; justify-content:space-between; align-items:center;">
    <div>
        <h3>{{ w.name }}</h3>
        <p class="meta">
            ソース: <span class="badge">{{ w.source }}</span>
            クエリ: {{ w.query }}
            {% if w.filters_json %}| フィルター: {{ w.filters_json }}{% endif %}
            | {{ "有効" if w.enabled else "無効" }}
        </p>
    </div>
    <div style="display:flex; gap:0.5rem;">
        <form method="post" action="/watches/{{ w.id }}/toggle">
            <button type="submit" class="btn-secondary" style="font-size:0.8rem; padding:0.3rem 0.6rem;">
                {{ "無効にする" if w.enabled else "有効にする" }}
            </button>
        </form>
        <form method="post" action="/watches/{{ w.id }}/run">
            <button type="submit" style="font-size:0.8rem; padding:0.3rem 0.6rem;">実行</button>
        </form>
    </div>
</div>
{% endfor %}
{% else %}
<p class="meta">Watch がまだありません。上のフォームから追加してください。</p>
{% endif %}
{% endblock %}
